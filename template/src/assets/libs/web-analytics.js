/*!
 * web-analytics.js v0.2.0
 * (c) 2017-2017 HuiHui
 * Released under the MIT License.
 */
!(function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(e){return"function"==typeof e&&/native code/.test(e.toString())}function n(e){"complete"===document.readyState?setTimeout(e,0):window.addEventListener("load",function(){setTimeout(e,0)})}function t(e){var n=[];for(var t in e)n.push(t+"="+encodeURIComponent(e[t]));return n.join("&")}function i(e,n){o(function(){var i=a+r++,o=window[i]=new Image;o.onload=o.onerror=function(){window[i]=null},o.src=u+t({path:location.href,type:e,data:JSON.stringify(n),v:"0.2.0",t:Date.now()})})}var o=function(){function n(){o=!1;var e=i.slice(0);i.length=0;for(var n=0;n<e.length;n++)e[n]()}var t,i=[],o=!1;if("undefined"!=typeof Promise&&e(Promise)){var r=Promise.resolve(),a=function(e){console.error(e)};t=function(){r.then(n).catch(a)}}else t=function(){setTimeout(n,0)};return function(e,n){i.push(function(){e.call(n)}),o||(o=!0,t())}}(),r=0,a="__ANALYTICS__",u="//sys.jiuyan.info/web/r.gif?";n(function(n){function t(e){a||(a=e),!d&&u&&((o=(e-u-c-0)/c)<0&&(o=0),o>1&&(o=1),f.perLine.push(o),f.timeLine.push(e),(r=f.timeLine.length)>2?(f.totalSize+=(f.perLine[r-1]+f.perLine[r-2])*(f.timeLine[r-1]-f.timeLine[r-2])/2,f.sizeLine.push(f.totalSize)):f.sizeLine.push(0),f.perLine.length>2&&(f.perLine.shift(),f.timeLine.shift())),u=e,d&&(d=!1),a&&e>=a+s?i("jank",{jank:f.sizeLine[f.sizeLine.length-1]-f.sizeLine[0],duration:s}):requestAnimationFrame(t)}var o,r,a,u,s=1e4,c=16.67,d=!1,f={perLine:[],timeLine:[],sizeLine:[],totalSize:0};window.addEventListener("touchmove",function(){d=!0},!1),window.addEventListener("blur",function(){d=!0},!1),"undefined"!=typeof requestAnimationFrame&&e(requestAnimationFrame)&&requestAnimationFrame(t)}),n(function(n){var t=window.performance;if(void 0===t||e(t.constructor)){var o=function(){return e(t.getEntriesByType)&&!!t.getEntriesByType("navigation")[0]}(),r=o?t.getEntriesByType("navigation")[0]:t.timing,a={},u=[["Unload","unloadEventStart","unloadEventEnd"],["App cache","fetchStart","domainLookupStart"],["DNS","domainLookupStart","domainLookupEnd"],["TCP","connectStart","connectEnd"],["Request","requestStart","responseStart"],["Response","responseStart","responseEnd"],["Processing","responseEnd","loadEventStart"],["Onload","loadEventStart","loadEventEnd"]];u.push(["Network/Server",o?"startTime":"navigationStart","responseStart"]),u.push(["Duration",o?"startTime":"navigationStart","loadEventEnd"]),r.secureConnectionStart&&u.push(["SSL","connectStart","secureConnectionStart"]),u.map(function(e){this[e[0]]=r[e[2]]-r[e[1]]},a),o&&t.getEntriesByType("resource").map(function(e){var n="Resource "+e.initiatorType.replace(/^(\S)/,function(e){return e.toUpperCase()});n in a?a[n]+=e.duration:a[n]=e.duration}),i("timeline",a)}})}));
